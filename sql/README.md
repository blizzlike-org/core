# Database

## Contributing

Do not edit the files in the base/ folder directly. Instead prepare update statements inside the updates/ folder.
A filename is an always incrementing 3 digit number, followed by a description (e.g `012-fix-zul-aman-chest-spawn.sql`).

It's also required to make use of the `TRANSACTION` instruction, in order to make sure that sql updates won't make it partly into a database on error.
You can have a look at [000-template.sql](updates/world/000-template.sql) as reference. An example of it would look like this:

    SET autocommit = OFF;
    START TRANSACTION;

    -- YOUR CHANGE GOES HERE

    COMMIT;

## Building a new Release

Here is an example how the current release is built. This should only be done in very rare and reasonable cases (such as running out of numbers).

    USER="mangos"
    PASS="mangos"
    PREFIX="tbc"

    mysqldump -u"$USER" -p"$PASS" ${PREFIX}mangos $(mysql -u"$USER" -p"$PASS" -D ${PREFIX}mangos -Bse "SHOW TABLES" | grep -v "^locales_") > world.sql
    mysqldump -u"$USER" -p"$PASS" ${PREFIX}mangos $(mysql -u"$USER" -p"$PASS" -D ${PREFIX}mangos -Bse "SHOW TABLES" | grep "^locales_") > world_locales.sql

    mysqldump -u"$USER" -p"$PASS" ${PREFIX}characters > characters.sql
    mysqldump -u"$USER" -p"$PASS" ${PREFIX}realmd > realmd.sql

    for i in *.sql; do
        sed -i '1,5d' $i
        sed -i '/-- Dump completed/d' $i
        sed -i '1i-- DO NOT EDIT THIS FILE DIRECTLY!' $i
    done
